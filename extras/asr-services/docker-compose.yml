services:
  parakeet-asr:
    build:
      context: .
      dockerfile: Dockerfile_Parakeet
      args:
        CUDA_VERSION: ${CUDA_VERSION:-cu121}
    image: parakeet-asr:latest
    ports:
      - "${PARAKEET_HOST_PORT:-8767}:${PARAKEET_CONTAINER_PORT:-8765}"
    volumes:
      # Persist Hugging Face cache (models + tokenizer) between restarts
      - ./model_cache:/models
      - ./debug:/app/debug
      - ./results:/app/results
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    environment:
      - HF_HOME=/models
      - PARAKEET_MODEL=$PARAKEET_MODEL
      # Enhanced chunking configuration
      - CHUNKING_ENABLED=${CHUNKING_ENABLED:-true}
      - CHUNK_DURATION_SECONDS=${CHUNK_DURATION_SECONDS:-30.0}
      - OVERLAP_DURATION_SECONDS=${OVERLAP_DURATION_SECONDS:-5.0}
      - MIN_AUDIO_FOR_CHUNKING=${MIN_AUDIO_FOR_CHUNKING:-60.0}
      - CONFIDENCE_THRESHOLD=${CONFIDENCE_THRESHOLD:-0.8}
    restart: unless-stopped

  # moonshine-asr:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile_Moonshine
  #   image: moonshine-asr:latest
  #   ports:
  #     - "8765:8765"  # Keep Moonshine on 8765 
  #   volumes:
  #     # Persist Hugging Face cache (models + tokenizer) between restarts
  #     - ./model_cache:/models
  #     - ./audio_chunks:/app/audio_chunks
  #     - ./debug:/app/debug
  #     - ./results:/app/results
  #   deploy:
  #     resources:
  #       reservations:
  #         devices:
  #           - driver: nvidia
  #             count: all
  #             capabilities: [gpu]
  #   environment:
  #     - HF_HOME=/models
  #   restart: unless-stopped